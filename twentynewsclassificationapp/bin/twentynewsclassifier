#!/usr/bin/env groovy

// this script runs the classification script example
import static groovy.io.FileType.FILES 

def mainClass = 'ai.vital.twentynewsClassificationApp.TwentyNewsClassificationApp'

def scriptDir = new File(getClass().protectionDomain.codeSource.location.path).parentFile.parentFile.getAbsolutePath() + '/'

def VITAL_HOME = System.getenv('VITAL_HOME')

if(!VITAL_HOME) { 
	System.err.println("VITAL_HOME environment variable not set.")
	System.exit(-1);
}

def vitalsignsDir = VITAL_HOME + '/vitalsigns'

def vitalDomainJar = VITAL_HOME + '/vital-domain/VitalDomain-groovy-0.1.0.jar'

def DIST_JAR = scriptDir + 'dist/twentynewsclassificationapp.jar'

List jars = [];
new File(vitalsignsDir).eachFileRecurse(FILES) {
	if(it.name.endsWith('.jar')) {
		jars.add(it.absolutePath);
	}
}

new File(scriptDir + 'lib').eachFileRecurse(FILES) {
	if(it.name.endsWith('.jar')) {
		jars.add(it.absolutePath);
	}
}

new File(VITAL_HOME, "domain-jar").eachFile(FILES) {
	if(it.name.endsWith(".jar")) {
		println "using domain jar: ${it.absolutePath}"
		jars.add(it.absolutePath)
	}
}

jars.add(vitalDomainJar)
jars.add(DIST_JAR)

List cmd = ['java', '-cp', (String)jars.join(File.pathSeparator), mainClass];

for(String a : args) {
	cmd.add(a)
}

def process = new ProcessBuilder(cmd).redirectErrorStream(true).start()
process.inputStream.eachLine {println it}